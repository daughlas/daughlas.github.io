<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>慕课网 Node.js 从零开发 web server博客项笔记 | 吕嘉文的小栈</title>
  <meta name="keywords" content=" Node.js ">
  <meta name="description" content="慕课网 Node.js 从零开发 web server博客项笔记 | 吕嘉文的小栈">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210">
<meta property="og:type" content="article">
<meta property="og:title" content="debounce 防抖">
<meta property="og:url" content="http://yoursite.com/2020/06/01/code-section/debounce/index.html">
<meta property="og:site_name" content="吕嘉文的小栈">
<meta property="og:description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-06-01T10:07:26.410Z">
<meta property="article:modified_time" content="2020-06-01T10:07:52.819Z">
<meta property="article:author" content="吕嘉文">
<meta property="article:tag" content="javascript">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1" ></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.0.1" ></script>

<meta name="generator" content="Hexo 4.2.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value="">
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>吕嘉文</span>
</div>

<div class="icon">
    
        
        <a title="github" href="https://github.com/daughlas" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
        <a title="weibo" href="http://weibo.com/u/2307534817" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-weibo"></use>
                </svg>
            
        </a>
        
    
        
        <a title="jianshu" href="https://www.jianshu.com/u/ff56736de7cf" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-jianshu"></use>
                </svg>
            
        </a>
        
    
        
    
        
        <a title="email" href="mailto:daughlas@gmail.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=806004005&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(23)</small></div></li>
    
        
            
            <li><div data-rel="一段代码">一段代码<small>(8)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="临时">临时<small>(9)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="纯前端">纯前端<small>(5)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="23">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode === 13){return false;}">
        <input id="local-search-input" class="search" type="text" placeholder="Search..." />
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a class="color1">javascript</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">临时</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">vue</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">vue-router</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">vue-cli</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">angular</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">Node.js</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <nav id="title-list-nav">
        
        <a  class="一段代码 "
           href="/2020/02/20/code-section/js-new/"
           data-tag="javascript"
           data-author="" >
            <span class="post-title" title="JS - new">JS - new</span>
            <span class="post-date" title="2020-02-20 15:40:32">2020/02/20</span>
        </a>
        
        <a  class="一段代码 "
           href="/2020/02/19/code-section/%E6%B7%B1%E6%8B%B7%E8%B4%9D/"
           data-tag="javascript"
           data-author="" >
            <span class="post-title" title="JS 深拷贝">JS 深拷贝</span>
            <span class="post-date" title="2020-02-19 09:39:56">2020/02/19</span>
        </a>
        
        <a  class="一段代码 "
           href="/2020/02/19/code-section/JS%20%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"
           data-tag="javascript"
           data-author="" >
            <span class="post-title" title="JS 数据类型">JS 数据类型</span>
            <span class="post-date" title="2020-02-19 11:15:20">2020/02/19</span>
        </a>
        
        <a  class="一段代码 "
           href="/2020/06/01/code-section/debounce/"
           data-tag="javascript"
           data-author="" >
            <span class="post-title" title="debounce 防抖">debounce 防抖</span>
            <span class="post-date" title="2020-06-01 18:07:26">2020/06/01</span>
        </a>
        
        <a  class="一段代码 "
           href="/2020/06/01/code-section/%E8%8A%82%E6%B5%81%E5%87%BD%E6%95%B0/"
           data-tag="javascript"
           data-author="" >
            <span class="post-title" title="throttle 节流函数">throttle 节流函数</span>
            <span class="post-date" title="2020-06-01 17:48:06">2020/06/01</span>
        </a>
        
        <a  class="一段代码 "
           href="/2020/02/19/code-section/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%89%88/"
           data-tag="javascript"
           data-author="" >
            <span class="post-title" title="JS 深拷贝性能优化版">JS 深拷贝性能优化版</span>
            <span class="post-date" title="2020-02-19 11:07:44">2020/02/19</span>
        </a>
        
        <a  class="一段代码 "
           href="/2020/06/01/code-section/%E8%8E%B7%E5%8F%96%E5%9C%B0%E5%9D%80%E6%A0%8F/"
           data-tag="javascript"
           data-author="" >
            <span class="post-title" title="获取地址栏参数">获取地址栏参数</span>
            <span class="post-date" title="2020-06-01 17:30:03">2020/06/01</span>
        </a>
        
        <a  class="临时 "
           href="/2020/06/01/temp/vs%20code%20%E4%BD%BF%E7%94%A8/"
           data-tag="临时"
           data-author="" >
            <span class="post-title" title="VS code 使用">VS code 使用</span>
            <span class="post-date" title="2020-06-01 17:51:56">2020/06/01</span>
        </a>
        
        <a  class="一段代码 "
           href="/2020/06/01/code-section/%E7%AE%80%E6%98%93%E6%A8%A1%E5%9D%97%E7%AE%A1%E7%90%86/"
           data-tag="javascript"
           data-author="" >
            <span class="post-title" title="简易模块管理">简易模块管理</span>
            <span class="post-date" title="2020-06-01 17:56:46">2020/06/01</span>
        </a>
        
        <a  class="临时 "
           href="/2020/06/01/temp/%E5%AD%A6%E4%B9%A0%20MyBatis/"
           data-tag="临时"
           data-author="" >
            <span class="post-title" title="学习 MyBatis">学习 MyBatis</span>
            <span class="post-date" title="2020-06-01 18:05:08">2020/06/01</span>
        </a>
        
        <a  class="临时 "
           href="/2020/06/01/temp/%E5%AD%A6%E4%B9%A0%20MongoDB/"
           data-tag="临时"
           data-author="" >
            <span class="post-title" title="学习 MongoDB">学习 MongoDB</span>
            <span class="post-date" title="2020-06-01 18:04:32">2020/06/01</span>
        </a>
        
        <a  class="临时 "
           href="/2020/06/01/temp/%E5%AD%A6%E4%B9%A0%20typescript/"
           data-tag="临时"
           data-author="" >
            <span class="post-title" title="学习 TypeScript">学习 TypeScript</span>
            <span class="post-date" title="2020-06-01 17:48:56">2020/06/01</span>
        </a>
        
        <a  class="纯前端 "
           href="/2020/02/20/vue/vue%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"
           data-tag="vue,vue-router"
           data-author="" >
            <span class="post-title" title="vue 最佳实践">vue 最佳实践</span>
            <span class="post-date" title="2020-02-20 14:15:21">2020/02/20</span>
        </a>
        
        <a  class="纯前端 "
           href="/2020/02/18/vue/vue-router%20%E4%BD%BF%E7%94%A8/"
           data-tag="vue,vue-router"
           data-author="" >
            <span class="post-title" title="vue-router 使用">vue-router 使用</span>
            <span class="post-date" title="2020-02-18 11:23:11">2020/02/18</span>
        </a>
        
        <a  class="纯前端 "
           href="/2020/02/20/vue/vue%20%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96/"
           data-tag="vue,vue-cli"
           data-author="" >
            <span class="post-title" title="vue-cli3 打包优化">vue-cli3 打包优化</span>
            <span class="post-date" title="2020-02-20 14:15:50">2020/02/20</span>
        </a>
        
        <a  class="纯前端 "
           href="/2020/02/18/vue/vue-router%20%E5%8E%9F%E7%90%86%EF%BC%88%E4%B8%80%EF%BC%89/"
           data-tag="vue,vue-router"
           data-author="" >
            <span class="post-title" title="vue-router 原理（一）">vue-router 原理（一）</span>
            <span class="post-date" title="2020-02-18 11:23:45">2020/02/18</span>
        </a>
        
        <a  class="临时 "
           href="/2020/06/01/temp/%E5%88%AB%E4%BA%BA%E6%80%BB%E7%BB%93%E7%9A%84%E5%BE%88%E5%A4%9A%E6%AD%A3%E5%88%99/"
           data-tag="临时"
           data-author="" >
            <span class="post-title" title="别人总结的各种各样的正则表达式">别人总结的各种各样的正则表达式</span>
            <span class="post-date" title="2020-06-01 17:54:05">2020/06/01</span>
        </a>
        
        <a  class="临时 "
           href="/2020/06/01/temp/%E5%AD%A6%E4%B9%A0%20HTTP%20%E5%8D%8F%E8%AE%AE/"
           data-tag="临时"
           data-author="" >
            <span class="post-title" title="学习 HTTP 协议">学习 HTTP 协议</span>
            <span class="post-date" title="2020-06-01 17:33:15">2020/06/01</span>
        </a>
        
        <a  class="临时 "
           href="/2020/06/01/temp/%E5%AD%A6%E4%B9%A0%20MySQL/"
           data-tag="临时"
           data-author="" >
            <span class="post-title" title="学习 MySQL">学习 MySQL</span>
            <span class="post-date" title="2020-06-01 18:03:06">2020/06/01</span>
        </a>
        
        <a  class=""
           href="/2020/06/01/temp/%E5%AD%A6%E4%B9%A0%20Rxjs/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="temp/学习 Rxjs">temp/学习 Rxjs</span>
            <span class="post-date" title="2020-06-01 17:43:52">2020/06/01</span>
        </a>
        
        <a  class="纯前端 "
           href="/2020/06/01/temp/%E5%AD%A6%E4%B9%A0%20angular/"
           data-tag="angular"
           data-author="" >
            <span class="post-title" title="学习 angular">学习 angular</span>
            <span class="post-date" title="2020-06-01 17:38:22">2020/06/01</span>
        </a>
        
        <a  class="临时 "
           href="/2020/06/01/temp/%E6%85%95%E8%AF%BE%E7%BD%91%20Node.js%20%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%8F%91%20web%20server%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%AC%94%E8%AE%B0/"
           data-tag="Node.js"
           data-author="" >
            <span class="post-title" title="慕课网 Node.js 从零开发 web server博客项笔记">慕课网 Node.js 从零开发 web server博客项笔记</span>
            <span class="post-date" title="2020-06-01 17:55:35">2020/06/01</span>
        </a>
        
        <a  class="临时 "
           href="/2020/06/01/temp/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0/"
           data-tag="临时"
           data-author="" >
            <span class="post-title" title="设计模式学习">设计模式学习</span>
            <span class="post-date" title="2020-06-01 17:57:57">2020/06/01</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-temp/慕课网 Node.js 从零开发 web server博客项笔记" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">慕课网 Node.js 从零开发 web server博客项笔记</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a  data-rel="临时">临时</a>
            
        </span>
        
        
        <span class="tag">
            
            <a class="color3">Node.js</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2020-06-01 17:56:00'>2020-06-01 17:55</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#慕课网-Node-js-从零开发-web-server博客项笔记"><span class="toc-text">慕课网 Node.js 从零开发 web server博客项笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#第-1-章-课程介绍"><span class="toc-text">第 1 章 课程介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第-2-章-Node-js-介绍"><span class="toc-text">第 2 章 Node.js 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#下载和安装"><span class="toc-text">下载和安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js-和-JS-的区别"><span class="toc-text">Node.js 和 JS 的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ECMAScript"><span class="toc-text">ECMAScript</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Javascript"><span class="toc-text">Javascript</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Node-js"><span class="toc-text">Node.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#commonjs-模块化"><span class="toc-text">commonjs 模块化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#引用第三方标准"><span class="toc-text">引用第三方标准</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js-debugger"><span class="toc-text">Node.js debugger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#server-端和前端的区别"><span class="toc-text">server 端和前端的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#服务稳定性"><span class="toc-text">服务稳定性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#考虑-CPU-和内存（优化、拓展）"><span class="toc-text">考虑 CPU 和内存（优化、拓展）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#日志记录"><span class="toc-text">日志记录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安全"><span class="toc-text">安全</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#集群和服务拆分"><span class="toc-text">集群和服务拆分</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第-3-章-项目介绍"><span class="toc-text">第 3 章 项目介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#项目需求分析"><span class="toc-text">项目需求分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#项目步骤"><span class="toc-text">项目步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#目标"><span class="toc-text">目标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#需求"><span class="toc-text">需求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#技术方案"><span class="toc-text">技术方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第-4-章-开发博客项目之接口"><span class="toc-text">第 4 章 开发博客项目之接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-http-概述"><span class="toc-text">4-1 http-概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#本章内容"><span class="toc-text">本章内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#从输入-URL-到现显示页面发生了什么"><span class="toc-text">从输入 URL 到现显示页面发生了什么</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-处理get请求"><span class="toc-text">4-2 处理get请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-处理post请求"><span class="toc-text">4-3 处理post请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-处理http请求的综合示例"><span class="toc-text">4-4 处理http请求的综合示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-搭建开发环境"><span class="toc-text">4-5 搭建开发环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-初始化路由"><span class="toc-text">4-6 初始化路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-开发路由（博客列表路由）-1"><span class="toc-text">4-7 开发路由（博客列表路由）_1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-开发路由（博客详情路由）"><span class="toc-text">4-8 开发路由（博客详情路由）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-开发路由（处理-POSTData）"><span class="toc-text">4-9 开发路由（处理 POSTData）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10-开发路由（新建和更新博客路由）"><span class="toc-text">4-10 开发路由（新建和更新博客路由）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-11-开发路由（删除博客路由和登录路由）"><span class="toc-text">4-11 开发路由（删除博客路由和登录路由）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第五章-开发博客项目的数据存储"><span class="toc-text">第五章 开发博客项目的数据存储</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-MySQL-简介"><span class="toc-text">5-1 MySQL 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-数据库操作（创建和增、删、查、更新）"><span class="toc-text">5-2 数据库操作（创建和增、删、查、更新）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#建库"><span class="toc-text">建库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#建表"><span class="toc-text">建表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#表操作"><span class="toc-text">表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#插入"><span class="toc-text">插入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#查询"><span class="toc-text">查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#更新"><span class="toc-text">更新</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#删除"><span class="toc-text">删除</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-Node-js-操作-MySQL"><span class="toc-text">5-4 Node.js 操作 MySQL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第六章-登录"><span class="toc-text">第六章 登录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-介绍"><span class="toc-text">6-1 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-cookie-介绍"><span class="toc-text">6-2 cookie 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#什么是-cookie"><span class="toc-text">什么是 cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#javascript-操作-cookie，浏览器中查看-cookie"><span class="toc-text">javascript 操作 cookie，浏览器中查看 cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#javascript-查看-cookie-的三种方式"><span class="toc-text">javascript 查看 cookie 的三种方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#javascript-查看、修改-cookie-（有限制）"><span class="toc-text">javascript 查看、修改 cookie （有限制）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#server-端操作cookie，实现登录验证"><span class="toc-text">server 端操作cookie，实现登录验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#session"><span class="toc-text">session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-8-从-session-到-redis"><span class="toc-text">6-8 从 session 到 redis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#redis"><span class="toc-text">redis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redis-解决方案"><span class="toc-text">redis 解决方案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#为何-session-使合用-redis"><span class="toc-text">为何 session 使合用 redis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#为何网站数据不适合用-redis"><span class="toc-text">为何网站数据不适合用 redis</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-9-redis-介绍"><span class="toc-text">6-9 redis 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装-redis"><span class="toc-text">安装 redis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用-redis"><span class="toc-text">使用 redis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#总结-1"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-10-Node-js-链接-redis"><span class="toc-text">6-10 Node.js 链接 redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-14-前端联调"><span class="toc-text">6-14 前端联调</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-15-nginx-介绍"><span class="toc-text">6-15 nginx 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nginx-命令"><span class="toc-text">nginx 命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-16-登录-总结"><span class="toc-text">6-16 登录-总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第-7-章-博客项目值日志"><span class="toc-text">第 7 章 博客项目值日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-日志基础"><span class="toc-text">7-1 日志基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-Node-js-文件操作"><span class="toc-text">7-2 Node.js 文件操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-stream-介绍"><span class="toc-text">7-3 stream 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IO-操作的性能瓶颈"><span class="toc-text">IO 操作的性能瓶颈</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-7-拆分日志"><span class="toc-text">7-7 拆分日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#crontab"><span class="toc-text">crontab</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#日志分析"><span class="toc-text">日志分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安全-1"><span class="toc-text">安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-开始和-sql-注入"><span class="toc-text">8-1 开始和 sql 注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-xss-攻击"><span class="toc-text">8-2 xss 攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-密码加密和总结"><span class="toc-text">8-3 密码加密和总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第-9-章-不使用框架开发-server-统一总结"><span class="toc-text">第 9 章 不使用框架开发 server 统一总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#开发了那些模块，完整的流程"><span class="toc-text">开发了那些模块，完整的流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用到了哪些核心的知识点"><span class="toc-text">用到了哪些核心的知识点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#回顾-server-和前端的区别"><span class="toc-text">回顾 server 和前端的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#下一步"><span class="toc-text">下一步</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第-10-章-使用-express-重构博客项目"><span class="toc-text">第 10 章 使用 express 重构博客项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#express-介绍"><span class="toc-text">express 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#什么框架"><span class="toc-text">什么框架</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#express-总结"><span class="toc-text">express 总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-8-express-处理-session"><span class="toc-text">10-8 express 处理 session</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-12-介绍-morgan"><span class="toc-text">10-12 介绍 morgan</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-14-express-中间件原理"><span class="toc-text">10-14 express 中间件原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-15-中间件代码实现"><span class="toc-text">10-15 中间件代码实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第-11-章-使用-Koa2-重构博客项目"><span class="toc-text">第 11 章 使用 Koa2 重构博客项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#async-await-语法介绍"><span class="toc-text">async &#x2F; await 语法介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Koa-2-简介"><span class="toc-text">Koa 2 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Koa-2-安装"><span class="toc-text">Koa 2 安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Koa-2-路由介绍"><span class="toc-text">Koa 2 路由介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#中间件机制"><span class="toc-text">中间件机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分析"><span class="toc-text">分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Koa-2-中间件原理"><span class="toc-text">Koa 2 中间件原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#koa2-总结"><span class="toc-text">koa2 总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#预习"><span class="toc-text">预习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#上线与配置"><span class="toc-text">上线与配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开始"><span class="toc-text">开始</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#线上环境"><span class="toc-text">线上环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PM2"><span class="toc-text">PM2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PM2-介绍"><span class="toc-text">PM2 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#下载安装"><span class="toc-text">下载安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#基本使用"><span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#核心价值"><span class="toc-text">核心价值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#常用命令"><span class="toc-text">常用命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PM2-进程守护"><span class="toc-text">PM2 进程守护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PM2-配置和日志记录"><span class="toc-text">PM2 配置和日志记录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置"><span class="toc-text">配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PM2-多进程"><span class="toc-text">PM2 多进程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#为何使用多进程"><span class="toc-text">为何使用多进程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多进程和-redis"><span class="toc-text">多进程和 redis</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结-2"><span class="toc-text">总结</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="慕课网-Node-js-从零开发-web-server博客项笔记"><a href="#慕课网-Node-js-从零开发-web-server博客项笔记" class="headerlink" title="慕课网 Node.js 从零开发 web server博客项笔记"></a>慕课网 Node.js 从零开发 web server博客项笔记</h1><h2 id="第-1-章-课程介绍"><a href="#第-1-章-课程介绍" class="headerlink" title="第 1 章 课程介绍"></a>第 1 章 课程介绍</h2><h2 id="第-2-章-Node-js-介绍"><a href="#第-2-章-Node-js-介绍" class="headerlink" title="第 2 章 Node.js 介绍"></a>第 2 章 Node.js 介绍</h2><h3 id="下载和安装"><a href="#下载和安装" class="headerlink" title="下载和安装"></a>下载和安装</h3><h3 id="Node-js-和-JS-的区别"><a href="#Node-js-和-JS-的区别" class="headerlink" title="Node.js 和 JS 的区别"></a>Node.js 和 JS 的区别</h3><h4 id="ECMAScript"><a href="#ECMAScript" class="headerlink" title="ECMAScript"></a>ECMAScript</h4><ul>
<li>定义了语法，写 javascript 和 Node.js 都必须遵守</li>
<li>变量定义，循环，判断，函数</li>
<li>原型和原型链，作用域和闭包，异步</li>
<li>不能操作 DOM，不能监听 click 事件，不能发送 ajax 请求</li>
<li>不能处理 http 请求，不能操作文件</li>
<li>只有 ECMAScript，几乎做不了任何实际的项目</li>
</ul>
<h4 id="Javascript"><a href="#Javascript" class="headerlink" title="Javascript"></a>Javascript</h4><ul>
<li>使用了 ECMAScript 语法规范，外加 Web API，缺一不可</li>
<li>DOM 操作，BOM 操作，事件绑定，Ajax 等</li>
<li>两者结合，才能完成浏览器端的任何操作</li>
</ul>
<h4 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h4><ul>
<li>使用了 ECMAScript 语法规范，外加 Node.js API，缺一不可</li>
<li>处理 http， 处理文件等，具体参考 <a href="http://nodejs.cn/api" target="_blank" rel="noopener">http://nodejs.cn/api</a></li>
<li>两者结合，才能完成 server 端的任何操作</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>ECMAScript 是语法规范</li>
<li>Node.js = ECMAScript + Node.js API</li>
<li>前端 JS = ECMAScript + Web API</li>
</ul>
<h3 id="commonjs-模块化"><a href="#commonjs-模块化" class="headerlink" title="commonjs 模块化"></a>commonjs 模块化</h3><p>a.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.expors = add</span><br></pre></td></tr></table></figure>



<p>b.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="built_in">require</span>(<span class="string">'./a'</span>)</span><br><span class="line">cosnt sum = add(<span class="number">10</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<p>c.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function add(a, b) &#123;</span><br><span class="line">    return a + b</span><br><span class="line">&#125;</span><br><span class="line">function mul(a, b) &#123;</span><br><span class="line">    return a * b</span><br><span class="line">&#125;</span><br><span class="line">module.expors &#x3D; &#123;</span><br><span class="line">	add,</span><br><span class="line">	mul</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>d.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; add, mul &#125; = <span class="built_in">require</span>(<span class="string">'./c.js'</span>)</span><br><span class="line"><span class="keyword">const</span> sum = add (<span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line"><span class="keyword">const</span> result = mul(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line"><span class="built_in">console</span>.log(sum, result)</span><br></pre></td></tr></table></figure>

<h4 id="引用第三方标准"><a href="#引用第三方标准" class="headerlink" title="引用第三方标准"></a>引用第三方标准</h4><p><code>npm init -y</code></p>
<p><code>npm install loadash --save</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">'lodash)</span></span><br><span class="line"><span class="string">const arr = _.concat([1, 2], 3)</span></span><br><span class="line"><span class="string">console.log('</span>arr...<span class="string">', arr)</span></span><br></pre></td></tr></table></figure>

<h3 id="Node-js-debugger"><a href="#Node-js-debugger" class="headerlink" title="Node.js debugger"></a>Node.js debugger</h3><p>方式：vs code debugger</p>
<p><code>mkdir debugger-test</code></p>
<p><code>cd debugger-test</code></p>
<p><code>npm init -y</code></p>
<p><code>touch index.js</code></p>
<p>vs code debug 的时候，会找到 package.json 里边 main 指向的主文件开始调试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.crateServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.writehead(<span class="number">200</span>, &#123;<span class="string">'content-type'</span>: <span class="string">'text/html'</span>&#125;)</span><br><span class="line">  res.end(<span class="string">'&lt;h1&gt;Hello world!&lt;/h1&gt;'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">300</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'listening on 3000 port'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="server-端和前端的区别"><a href="#server-端和前端的区别" class="headerlink" title="server 端和前端的区别"></a>server 端和前端的区别</h3><ul>
<li>服务稳定性</li>
<li>考虑内存和 CPU （优化和拓展）</li>
<li>日志记录</li>
<li>安全</li>
<li>集群和服务拆分</li>
</ul>
<h4 id="服务稳定性"><a href="#服务稳定性" class="headerlink" title="服务稳定性"></a>服务稳定性</h4><ul>
<li>server 端可能会遭受各种恶意攻击和误操作</li>
<li>单个客户端可以意外挂掉，但是服务端不能</li>
<li>PM2 进程守候（程序挂掉，自动重启）</li>
</ul>
<h4 id="考虑-CPU-和内存（优化、拓展）"><a href="#考虑-CPU-和内存（优化、拓展）" class="headerlink" title="考虑 CPU 和内存（优化、拓展）"></a>考虑 CPU 和内存（优化、拓展）</h4><ul>
<li>客户端独占一个浏览器，内存和 CPU 都不是问题</li>
<li>server 端要承载很多请求，CPU 和 内存都是稀缺资源</li>
<li>课程后面会讲解使用 stream 写日志，使用 redis 存 session</li>
</ul>
<h4 id="日志记录"><a href="#日志记录" class="headerlink" title="日志记录"></a>日志记录</h4><ul>
<li>前端也会参与写日志，但知识日志的发起方，不关心后续</li>
<li>server 端要记录日志、存储日志、分析日志，前端不关心</li>
<li>可以使用多种日志记录方式</li>
</ul>
<h4 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h4><ul>
<li>server 端要随时准备接收各种恶意攻击，前端则少很多</li>
<li>如：越权操作，数据库攻击等</li>
<li>理解登录验证，预防 xss 攻击 和 sql 注入</li>
</ul>
<h4 id="集群和服务拆分"><a href="#集群和服务拆分" class="headerlink" title="集群和服务拆分"></a>集群和服务拆分</h4><ul>
<li>产品发展速度快，流量可能会迅速增加</li>
<li>如何通过拓展机器和服务拆分来承载大流量</li>
</ul>
<h2 id="第-3-章-项目介绍"><a href="#第-3-章-项目介绍" class="headerlink" title="第 3 章 项目介绍"></a>第 3 章 项目介绍</h2><h3 id="项目需求分析"><a href="#项目需求分析" class="headerlink" title="项目需求分析"></a>项目需求分析</h3><h4 id="项目步骤"><a href="#项目步骤" class="headerlink" title="项目步骤"></a>项目步骤</h4><p>定目标，定需求，定UI设计，定技术方案，开发，联调、测试、上线、分析统计结果评估</p>
<h4 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h4><ul>
<li>开发一个博客系统，具有博客的基本功能</li>
</ul>
<h4 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h4><ul>
<li>首页，作者主页，博客详情页</li>
<li>登陆页</li>
<li>管理中心，新建页，编辑页</li>
</ul>
<h3 id="技术方案"><a href="#技术方案" class="headerlink" title="技术方案"></a>技术方案</h3><ul>
<li>数据如何存储<ul>
<li>博客</li>
<li>用户</li>
</ul>
</li>
<li>如何与前端对接，即接口设计<ul>
<li>/api/blog/list，get，author 和 keyword</li>
<li>/api/blog/detail，get，id</li>
<li>/api/blog/new，post，新增内容</li>
<li>/api/blog/update， post，id，更新内容</li>
<li>/api/blog/del，post，id</li>
<li>/api/user/login，post，用户名和密码</li>
</ul>
</li>
<li>登录<ul>
<li>业界有统一的解决方案，一般不用重新设计</li>
</ul>
</li>
</ul>
<h2 id="第-4-章-开发博客项目之接口"><a href="#第-4-章-开发博客项目之接口" class="headerlink" title="第 4 章 开发博客项目之接口"></a>第 4 章 开发博客项目之接口</h2><h3 id="4-1-http-概述"><a href="#4-1-http-概述" class="headerlink" title="4-1 http-概述"></a>4-1 http-概述</h3><h4 id="本章内容"><a href="#本章内容" class="headerlink" title="本章内容"></a>本章内容</h4><ul>
<li>Node.js 如何处理 http 请求</li>
<li>搭建开发环境</li>
<li>开发接口（暂时不连数据库，暂时不考虑登录）</li>
</ul>
<h4 id="从输入-URL-到现显示页面发生了什么"><a href="#从输入-URL-到现显示页面发生了什么" class="headerlink" title="从输入 URL 到现显示页面发生了什么"></a>从输入 URL 到现显示页面发生了什么</h4><ol>
<li>DNS 解析，建立 TCP 连接，发送 http 请求<ol>
<li>先看缓存</li>
<li>没有缓存再去查找</li>
<li>三次握手<ol>
<li>客户端询问服务器，你是否可用</li>
<li>服务器回复客户端，我可用</li>
<li>客户端告诉服务器，我知道了，我即将访问</li>
</ol>
</li>
</ol>
</li>
<li>server 接收到 http 请求，处理，并返回</li>
<li>客户端接收到返回数据，处理数据（如渲染页面，执行 js） </li>
</ol>
<h3 id="4-2-处理get请求"><a href="#4-2-处理get请求" class="headerlink" title="4-2 处理get请求"></a>4-2 处理get请求</h3><p>解析 query string</p>
<ul>
<li>get 请求，即客户端向 server 端获取数据，如查询博客列表</li>
<li>通过 querystring 来传递数据，如a.html?a=100&amp;b=200</li>
<li>浏览器直接访问地址，发送 get 请求</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const http &#x3D; require(&#39;http&#39;)</span><br><span class="line">const querystring &#x3D; require(&#39;querystring&#39;)</span><br><span class="line"></span><br><span class="line">const server &#x3D; http.createServer((req, res) &#x3D;&gt; &#123;</span><br><span class="line">	console.log(req.method)</span><br><span class="line">	const url &#x3D; req.url</span><br><span class="line">	req.query &#x3D; querystring.parse(url.split(&#39;?&#39;)[1])</span><br><span class="line">  res.end(JSON.stringify(req.query))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(8000)</span><br></pre></td></tr></table></figure>

<h3 id="4-3-处理post请求"><a href="#4-3-处理post请求" class="headerlink" title="4-3 处理post请求"></a>4-3 处理post请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const http &#x3D; require(&#39;http&#39;)</span><br><span class="line"></span><br><span class="line">const server &#x3D; http.createServer((req, res) &#x3D;&gt; &#123;</span><br><span class="line">	if (req.method !&#x3D;&#x3D; &#39;POST&#39;) &#123;</span><br><span class="line">		console.log(&#39;不是 post 请求&#39;)</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	console.log(&#39;content-type&#39;, req.headers[&#39;content-type&#39;])</span><br><span class="line">	let postData &#x3D; &#39;&#39;</span><br><span class="line">	req.on(&#39;data&#39;, chunk &#x3D;&gt; &#123;</span><br><span class="line">		postData +&#x3D; chunk.toString()</span><br><span class="line">	&#125;)</span><br><span class="line">	req.on(&#39;end&#39; () &#x3D;&gt; &#123;</span><br><span class="line">		console.log(postData)</span><br><span class="line">		res.end(&#39;hello world&#39;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(8000, () &#x3D;&gt; &#123;</span><br><span class="line">  console.log(&#39;listening port 8000&#39;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="4-4-处理http请求的综合示例"><a href="#4-4-处理http请求的综合示例" class="headerlink" title="4-4 处理http请求的综合示例"></a>4-4 处理http请求的综合示例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	 <span class="keyword">const</span> method = req.method</span><br><span class="line">	 <span class="keyword">const</span> url = req.url</span><br><span class="line">	 <span class="keyword">const</span> path = url.split(<span class="string">'?'</span>)[<span class="number">0</span>]</span><br><span class="line">	 <span class="keyword">const</span> query = querystring.parse(url.split(<span class="string">'?'</span>)[<span class="number">1</span>])</span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">// 设置返回格式为 JSON，返回的字符串到底是什么格式的，可以是 JSON， text/html 或者二进制字符串</span></span><br><span class="line">	 res.setHeader(<span class="string">'Content-type'</span>, <span class="string">'application/json'</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 返回的数据</span></span><br><span class="line">  <span class="keyword">const</span> resData = &#123;</span><br><span class="line">    method,</span><br><span class="line">    url,</span><br><span class="line">    path,</span><br><span class="line">    query</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 返回</span></span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">'GET'</span>) &#123;</span><br><span class="line">    res.end(</span><br><span class="line">    	<span class="built_in">JSON</span>.stringify(resData)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> postData = <span class="string">''</span></span><br><span class="line">    req.on(<span class="string">'data'</span>, chunk =&gt; &#123;</span><br><span class="line">      postData += chunk.toString()</span><br><span class="line">    &#125;)</span><br><span class="line">    req.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">      resData.postData = postData</span><br><span class="line">      res.end(</span><br><span class="line">        <span class="built_in">JSON</span>.stringify(resData)</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8000</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'listening port 8000'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="4-5-搭建开发环境"><a href="#4-5-搭建开发环境" class="headerlink" title="4-5 搭建开发环境"></a>4-5 搭建开发环境</h3><p>使用 nodemon 监测文件变化，自动重启 node</p>
<p>使用 cross-env 设置环境变量，兼容 mac，linux 和 windows</p>
<h3 id="4-6-初始化路由"><a href="#4-6-初始化路由" class="headerlink" title="4-6 初始化路由"></a>4-6 初始化路由</h3><p>开发接口的第一步</p>
<p>根据之前技术方案的设计，作出路由</p>
<p>目前阶段：返回假数据，将路由和数据处理分离，以符合设计原则</p>
<h3 id="4-7-开发路由（博客列表路由）-1"><a href="#4-7-开发路由（博客列表路由）-1" class="headerlink" title="4-7 开发路由（博客列表路由）_1"></a>4-7 开发路由（博客列表路由）_1</h3><h3 id="4-8-开发路由（博客详情路由）"><a href="#4-8-开发路由（博客详情路由）" class="headerlink" title="4-8 开发路由（博客详情路由）"></a>4-8 开发路由（博客详情路由）</h3><h3 id="4-9-开发路由（处理-POSTData）"><a href="#4-9-开发路由（处理-POSTData）" class="headerlink" title="4-9 开发路由（处理 POSTData）"></a>4-9 开发路由（处理 POSTData）</h3><h3 id="4-10-开发路由（新建和更新博客路由）"><a href="#4-10-开发路由（新建和更新博客路由）" class="headerlink" title="4-10 开发路由（新建和更新博客路由）"></a>4-10 开发路由（新建和更新博客路由）</h3><h3 id="4-11-开发路由（删除博客路由和登录路由）"><a href="#4-11-开发路由（删除博客路由和登录路由）" class="headerlink" title="4-11 开发路由（删除博客路由和登录路由）"></a>4-11 开发路由（删除博客路由和登录路由）</h3><h2 id="第五章-开发博客项目的数据存储"><a href="#第五章-开发博客项目的数据存储" class="headerlink" title="第五章 开发博客项目的数据存储"></a>第五章 开发博客项目的数据存储</h2><h3 id="5-1-MySQL-简介"><a href="#5-1-MySQL-简介" class="headerlink" title="5-1 MySQL 简介"></a>5-1 MySQL 简介</h3><p><a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/mysql/</a></p>
<p><a href="https://dev.mysql.com/downloads/workbench/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/workbench/</a></p>
<h3 id="5-2-数据库操作（创建和增、删、查、更新）"><a href="#5-2-数据库操作（创建和增、删、查、更新）" class="headerlink" title="5-2 数据库操作（创建和增、删、查、更新）"></a>5-2 数据库操作（创建和增、删、查、更新）</h3><h4 id="建库"><a href="#建库" class="headerlink" title="建库"></a>建库</h4><ul>
<li>创建 myblog 数据库，<code>CREATE SCHEMA &#39;myblog&#39;;</code></li>
<li>执行 <code>show databases;</code>查询</li>
</ul>
<h4 id="建表"><a href="#建表" class="headerlink" title="建表"></a>建表</h4><p>![image-20190521131659928](/Users/lvjiawen/Library/Application Support/typora-user-images/image-20190521131659928.png)</p>
<p>![image-20190521131747841](/Users/lvjiawen/Library/Application Support/typora-user-images/image-20190521131747841.png)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;myblog&#96;.&#96;users&#96; (</span><br><span class="line">  &#96;id&#96; INT NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;username&#96; VARCHAR(20) NOT NULL,</span><br><span class="line">  &#96;password&#96; VARCHAR(20) NOT NULL,</span><br><span class="line">  &#96;realname&#96; VARCHAR(10) NOT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;));</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;myblog&#96;.&#96;blogs&#96; (</span><br><span class="line">  &#96;id&#96; INT NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;title&#96; VARCHAR(50) NOT NULL,</span><br><span class="line">  &#96;content&#96; LONGTEXT NOT NULL,</span><br><span class="line">  &#96;create&#96; BIGINT(20) NOT NULL DEFAULT 0,</span><br><span class="line">  &#96;author&#96; VARCHAR(20) NOT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;));</span><br></pre></td></tr></table></figure>

<h4 id="表操作"><a href="#表操作" class="headerlink" title="表操作"></a>表操作</h4><p><code>use myblog;</code></p>
<p><code>-- show tables;</code></p>
<h5 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into users (username, &#96;password&#96;, realname) values (&#39;zhangsan&#39;, &#39;123&#39;, &#39;张三&#39;);</span><br></pre></td></tr></table></figure>

<h5 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h5><p>查所有的列</p>
<p><code>-- select * from users;</code></p>
<p>查看指定的列</p>
<p><code>-- select id, username from users;</code></p>
<p>按照单个条件查询</p>
<p><code>-- select id, username from users where username=&#39;zhangsan&#39;;</code></p>
<p>按照多个条件查询</p>
<p><code>-- select id, username from users where username=&#39;zhangsan&#39; and password=&#39;123&#39;;</code></p>
<p><code>-- select id, username from users where username=&#39;zhangsan&#39; or password=&#39;123&#39;;</code></p>
<p>like 语句，模糊查询</p>
<p><code>-- select id, username from users where username like &#39;%zhang%&#39;;</code></p>
<p>排序</p>
<p><code>-- select id, username from users where username=&#39;zhangsan&#39; or password=&#39;123&#39; order by id desc;</code></p>
<h5 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h5><p><code>update users set realname=&#39;李四2&#39; where realname&#39;李四&#39;;</code></p>
<p>解决一下问题</p>
<p><code>SET SQL_SAFE_UPDATES = 0</code></p>
<h5 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h5><p><code>delete from users where username=&#39;lisi&#39;;</code></p>
<p>开发中删除操作，一般是加一个状态的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`myblog`</span>.<span class="string">`users`</span> </span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">COLUMN</span> <span class="string">`state`</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span> <span class="keyword">AFTER</span> <span class="string">`realname`</span>;</span><br></pre></td></tr></table></figure>

<p><code>select * from users where state=&#39;1&#39;;</code></p>
<p><code>update users set state=&#39;0&#39; where username=&#39;lisi&#39;</code> </p>
<p>不等于 <code>state &lt;&gt; &#39;0&#39;</code></p>
<h3 id="5-4-Node-js-操作-MySQL"><a href="#5-4-Node-js-操作-MySQL" class="headerlink" title="5-4 Node.js 操作 MySQL"></a>5-4 Node.js 操作 MySQL</h3><ul>
<li>封装：将其封装为系统可用的工具，配置数据库，线上限制某些操作</li>
<li>使用：让 API 直接操作数据库，不再使用假数据</li>
<li>select 语句返回的都是数组</li>
<li>update, delete, insert返回的如下</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    fieldCount: 0,</span><br><span class="line">    affectedRows: 1,</span><br><span class="line">    insertId: 5,</span><br><span class="line">    serverStatus: 2,</span><br><span class="line">    warningCount: 0,</span><br><span class="line">    message: &#39;&#39;,</span><br><span class="line">    protocol41: true,</span><br><span class="line">    changedRows: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第六章-登录"><a href="#第六章-登录" class="headerlink" title="第六章 登录"></a>第六章 登录</h2><h3 id="6-1-介绍"><a href="#6-1-介绍" class="headerlink" title="6-1 介绍"></a>6-1 介绍</h3><ul>
<li><p>核心：</p>
<ul>
<li>登陆校验：进入管理中心，删除博客，更新博客，新增博客必须登陆之后操作</li>
<li>登录信息的存储：用户名等信息</li>
</ul>
</li>
<li><p>cookie 和 session</p>
</li>
<li><p>session 写入 redis（内存数据库）</p>
</li>
<li><p>开发登陆功能，和前端联调（用到 nginx 反向代理）</p>
</li>
</ul>
<h3 id="6-2-cookie-介绍"><a href="#6-2-cookie-介绍" class="headerlink" title="6-2 cookie 介绍"></a>6-2 cookie 介绍</h3><h4 id="什么是-cookie"><a href="#什么是-cookie" class="headerlink" title="什么是 cookie"></a>什么是 cookie</h4><ul>
<li>存储在浏览器的一段字符串（最大 5kb）</li>
<li>跨域不共享</li>
<li>格式入k1=v1;k2=v2;k3=v3;因此可以存储结构化数据</li>
<li>每次发送 http 请求，会将请求域的 cookie 一起发送给 server</li>
<li>server 端可以修改 cookie 的值并返回给浏览器</li>
<li>浏览器中也可以通过 javascript 修改 cookie（有限制，server 端锁死）</li>
</ul>
<h4 id="javascript-操作-cookie，浏览器中查看-cookie"><a href="#javascript-操作-cookie，浏览器中查看-cookie" class="headerlink" title="javascript 操作 cookie，浏览器中查看 cookie"></a>javascript 操作 cookie，浏览器中查看 cookie</h4><h5 id="javascript-查看-cookie-的三种方式"><a href="#javascript-查看-cookie-的三种方式" class="headerlink" title="javascript 查看 cookie 的三种方式"></a>javascript 查看 cookie 的三种方式</h5><ul>
<li><p>浏览器中的 Network</p>
</li>
<li><p>浏览器中的 Application</p>
</li>
<li><p><code>document.cookie</code></p>
</li>
</ul>
<h5 id="javascript-查看、修改-cookie-（有限制）"><a href="#javascript-查看、修改-cookie-（有限制）" class="headerlink" title="javascript 查看、修改 cookie （有限制）"></a>javascript 查看、修改 cookie （有限制）</h5><p>追加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">document.cookie &#x3D; &#39;k1&#x3D;100&#39;;</span><br><span class="line">document.cookie &#x3D; &#39;k2&#x3D;200&#39;;</span><br></pre></td></tr></table></figure>

<h4 id="server-端操作cookie，实现登录验证"><a href="#server-端操作cookie，实现登录验证" class="headerlink" title="server 端操作cookie，实现登录验证"></a>server 端操作cookie，实现登录验证</h4><ul>
<li>查看 cookie</li>
<li>修改 cookie</li>
<li>实现登录验证</li>
</ul>
<h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><ul>
<li><p>用 cookie 实现登录，会暴露 username， 很危险</p>
</li>
<li><p>解决：cookie 中存储 userid，server 端 对应 username</p>
</li>
<li><p>如何实现 session</p>
</li>
</ul>
<h3 id="6-8-从-session-到-redis"><a href="#6-8-从-session-到-redis" class="headerlink" title="6-8 从 session 到 redis"></a>6-8 从 session 到 redis</h3><p>当前设置 session 还是有问题，初级的解决方法是放在 sessionData 这样一个变量里边，放在 nodejs 进程内存中</p>
<p> 进程内存有限，访问量过大，session 就会过大，内存就会暴增</p>
<p>正式线上运行是多线程，进程之间内存无法共享</p>
<p>![image-20190603171307235](/Users/lvjiawen/Library/Application Support/typora-user-images/image-20190603171307235.png)</p>
<p>stack 栈，基础类型变量，数字，布尔类型变量</p>
<p>heap 堆，引用类型，数组、对象、函数存在这儿，session 存在这儿，session 越多 heap 就会越高，越来越高，进程就崩了。</p>
<p>操作系统会限制一个进程的最大可用内存，Node.js 在 32 位系统中有1.6 Ghz 的内存 限制，在 64 位的系统中有 3 G 的内存限制。</p>
<p>![image-20190603171621574](/Users/lvjiawen/Library/Application Support/typora-user-images/image-20190603171621574.png)</p>
<p>![image-20190603171709827](/Users/lvjiawen/Library/Application Support/typora-user-images/image-20190603171709827.png)</p>
<p>服务器环境下 Node.js 都是分多个进程来跑的</p>
<h4 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h4><ul>
<li><p>内存数据库</p>
</li>
<li><p>web server 最常用的缓存数据库，数据存放在内存中</p>
</li>
<li><p>相比于 mysql，访问速度快</p>
</li>
<li><p>但是成本更高，可存储的数量个小</p>
</li>
<li><p>断电丢失数据</p>
</li>
</ul>
<h4 id="redis-解决方案"><a href="#redis-解决方案" class="headerlink" title="redis 解决方案"></a>redis 解决方案</h4><ul>
<li>将 web server 和 redis 拆分成两个单独的服务</li>
<li>双方都是独立的，都是可拓展的</li>
<li>包括 mysql，也是一个单独的服务</li>
</ul>
<h4 id="为何-session-使合用-redis"><a href="#为何-session-使合用-redis" class="headerlink" title="为何 session 使合用 redis"></a>为何 session 使合用 redis</h4><ul>
<li>session 访问频率，对性能要求极高，前置操作，所有请求都要请求 session</li>
<li>session 可以不考虑断电丢失数据的问题</li>
<li>session 数据量不会太大</li>
</ul>
<h4 id="为何网站数据不适合用-redis"><a href="#为何网站数据不适合用-redis" class="headerlink" title="为何网站数据不适合用 redis"></a>为何网站数据不适合用 redis</h4><ul>
<li>操作频率不太高（相比于 session 操作）</li>
<li>断电不能丢失数据，必须保留</li>
<li>数据量太大，内存成本太高</li>
</ul>
<h3 id="6-9-redis-介绍"><a href="#6-9-redis-介绍" class="headerlink" title="6-9 redis 介绍"></a>6-9 redis 介绍</h3><h4 id="安装-redis"><a href="#安装-redis" class="headerlink" title="安装 redis"></a>安装 redis</h4><p><code>brew install redis</code></p>
<p><code>redis-server</code></p>
<p><code>redis-cli</code></p>
<h4 id="使用-redis"><a href="#使用-redis" class="headerlink" title="使用 redis"></a>使用 redis</h4><p><code>set myname lvjiawen</code></p>
<p><code>get myname</code></p>
<p><code>keys *</code></p>
<p><code>del myname</code></p>
<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><ul>
<li>为何要用 redis，不用redis 会出现什么问题？</li>
<li>redis 适合什么场景？mysql 适合什么场景？</li>
</ul>
<h3 id="6-10-Node-js-链接-redis"><a href="#6-10-Node-js-链接-redis" class="headerlink" title="6-10 Node.js 链接 redis"></a>6-10 Node.js 链接 redis</h3><p>index.js</p>
<p><code>npm i redis --save</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> redis = <span class="built_in">require</span>(<span class="string">'redis'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建客户端</span></span><br><span class="line"><span class="keyword">const</span> redisClient = redis.creareClient(<span class="number">6379</span>, <span class="string">'127.0.0.1'</span>)</span><br><span class="line">redisClient.on(<span class="string">'error'</span>, err =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line">redisClient.set(<span class="string">'myname'</span>, <span class="string">'zhangsan2'</span>, redis.print)</span><br><span class="line">redisClient.get(<span class="string">'myname'</span>, (err, val) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log( <span class="string">'val '</span>, val) </span><br><span class="line">  redisClient.quit()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="6-14-前端联调"><a href="#6-14-前端联调" class="headerlink" title="6-14 前端联调"></a>6-14 前端联调</h3><ul>
<li>登录功能以来 cookie，必须浏览器来联调</li>
<li>cookie 跨域不共享，前端和 server 必须同域</li>
<li>需要用到 nignx 做代理，让前端后端同域</li>
</ul>
<h3 id="6-15-nginx-介绍"><a href="#6-15-nginx-介绍" class="headerlink" title="6-15 nginx 介绍"></a>6-15 nginx 介绍</h3><ul>
<li>高性能的 web 服务器，开源免费</li>
<li>一般用于做静态服务、负载均衡（本课程用不到）</li>
<li>反向代理（本科用到）</li>
</ul>
<p>客户端能够控制的代理，叫正向代理</p>
<p>客户端不能控制的代理，叫反向代理</p>
<p>配置文件位置：</p>
<p>windows： C:\nginx\conf\nginx.conf</p>
<p>Mac: /usr/local/etc/nginx/nginx.conf</p>
<h4 id="nginx-命令"><a href="#nginx-命令" class="headerlink" title="nginx 命令"></a>nginx 命令</h4><ul>
<li><p>测试配置文件格式是否正确 <code>nginx -t</code></p>
</li>
<li><p>启动 <code>nginx</code></p>
</li>
<li><p>重启 <code>nginx -s reload</code></p>
</li>
<li><p>停止 <code>nginx -s stop</code></p>
</li>
<li><p>打开配置文件 <code>sudo vi /usr/local/etc/nginx/nginx.conf</code></p>
</li>
<li><p>修改第三行 <code>worker_processes 2;</code> 多核可以启动多个进程</p>
</li>
<li><p>修改 server </p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen      8080;</span><br><span class="line">	...</span><br><span class="line">	# location &#x2F; &#123;</span><br><span class="line">	# ...	</span><br><span class="line">	# &#125;</span><br><span class="line">	location &#x2F; &#123;</span><br><span class="line">		proxy_pass http:&#x2F;&#x2F;localhost:8001;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	location &#x2F;api&#x2F; &#123;</span><br><span class="line">		proxy_pass http:&#x2F;&#x2F;localhost:8000;</span><br><span class="line">		proxy_set_header Host $host;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>:wq</code> 保存</p>
<h3 id="6-16-登录-总结"><a href="#6-16-登录-总结" class="headerlink" title="6-16 登录-总结"></a>6-16 登录-总结</h3><ul>
<li>cookie 是什么？ session 是什么？如何实现登录？</li>
<li>redis 在这里扮演的角色？有什么核心价值</li>
<li>nginx 的反向代理配置？联调中的作用</li>
</ul>
<h2 id="第-7-章-博客项目值日志"><a href="#第-7-章-博客项目值日志" class="headerlink" title="第 7 章 博客项目值日志"></a>第 7 章 博客项目值日志</h2><h3 id="7-1-日志基础"><a href="#7-1-日志基础" class="headerlink" title="7-1 日志基础"></a>7-1 日志基础</h3><p><strong>QPS</strong> 每秒访问量 query per seconds</p>
<p>日志包括：</p>
<ul>
<li>访问日志，access log，server 最重要的日志</li>
<li>自定义日志，包括自定义事件、错误记录等</li>
</ul>
<p>技能：</p>
<ul>
<li>Node.js 文件操作，Node.js stream（server 端要节省使用 CPU 和内存）</li>
<li>日志功能的开发和使用</li>
<li>日志文件拆分（例如每天一个文件  ）</li>
<li>日志内容分析</li>
</ul>
<p>日志为什么放在文件中？</p>
<ul>
<li><p>要有表结构，多表联动查询才用 mysql</p>
</li>
<li><p>文件大，性能要求不高，redis 不能放</p>
</li>
</ul>
<h3 id="7-2-Node-js-文件操作"><a href="#7-2-Node-js-文件操作" class="headerlink" title="7-2 Node.js 文件操作"></a>7-2 Node.js 文件操作</h3><h3 id="7-3-stream-介绍"><a href="#7-3-stream-介绍" class="headerlink" title="7-3 stream 介绍"></a>7-3 stream 介绍</h3><h4 id="IO-操作的性能瓶颈"><a href="#IO-操作的性能瓶颈" class="headerlink" title="IO 操作的性能瓶颈"></a>IO 操作的性能瓶颈</h4><ul>
<li>IO（in-out 输入输出） 包括”网络IO” 和”文件IO”</li>
<li>相比于 CPU 计算和内存读写，IO 的突出特点就是”慢”</li>
<li>如何在有限的硬件资源下提高 IO 的操作效率？stream</li>
</ul>
<p>代码示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (req.method===<span class="string">'POST'</span>) &#123;</span><br><span class="line">		<span class="keyword">let</span> result = <span class="string">''</span></span><br><span class="line">		req.on(<span class="string">'data'</span>, (chunk) =&gt; &#123;</span><br><span class="line">			result += chunk.toString()</span><br><span class="line">		&#125;)</span><br><span class="line">		req.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">			res.end(<span class="string">'OK'</span>)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-7-拆分日志"><a href="#7-7-拆分日志" class="headerlink" title="7-7 拆分日志"></a>7-7 拆分日志</h3><ul>
<li><p>日志内容慢慢积累，放在一个文件夹不好处理</p>
</li>
<li><p>按时间划分日志文件，入 2019-02-10.access.log</p>
</li>
<li><p>实现方式：linux、macOS 的 crontab 命令，即定时任务</p>
</li>
</ul>
<h4 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h4><ul>
<li>设置定时任务，格式：***** command，第一个 * 是分钟，第二个 * 是小时（1-24），第三个是日期，第四个十月份，第五个是星期几</li>
<li>将 access.log 拷贝并重命名为 2019-02-10.access.log</li>
<li>清空 access.log 文件，继续积累日志</li>
</ul>
<p><code>crontab -e</code> 新建</p>
<p><code>* 0 * * *  sh /Users/lvjiawen/Desktop/my-blog/code/blog-1/src/utils/copy.sh</code></p>
<p><code>crontab -l</code>查看</p>
<h4 id="日志分析"><a href="#日志分析" class="headerlink" title="日志分析"></a>日志分析</h4><ul>
<li>针对 access.log 日志，分析chrome 的占比</li>
<li>日志是按行存储的，一行就是一条日志</li>
<li>使用 Node.js 的 readline，基于 stream，效率很高</li>
</ul>
<h2 id="安全-1"><a href="#安全-1" class="headerlink" title="安全"></a>安全</h2><ul>
<li>sql 注入：窃取数据库内容</li>
<li>XSS 攻击：窃取前端 cookie 内容</li>
<li>密码加密：保障用户信息安全（重要！）</li>
<li>server 端攻击方式非常多，预防手段也非常多，这里记录常见的、能通过 web server （Node.js）层面预防的，有些攻击需要硬件和服务来支持（需要OP 支持），如 DDOS </li>
</ul>
<h3 id="8-1-开始和-sql-注入"><a href="#8-1-开始和-sql-注入" class="headerlink" title="8-1 开始和 sql 注入"></a>8-1 开始和 sql 注入</h3><ul>
<li>最原始、最简单的攻击，从有了 web2.0（允许用户提交信息）就有了 SQL 注入攻击</li>
<li>攻击方式：输入一个 SQL 片段，最终拼接成一段攻击代码</li>
<li>预防措施：使用 MySQL 的 escape 函数处理输入内容即可</li>
<li>输入<code>&#39; —</code>，利用 SQL 的 ``–` 注释语句</li>
<li>输入<code>&#39;;delete from users; --</code> 删除用户表</li>
</ul>
<h3 id="8-2-xss-攻击"><a href="#8-2-xss-攻击" class="headerlink" title="8-2 xss 攻击"></a>8-2 xss 攻击</h3><ul>
<li>前端同学最熟悉的攻击方式，但 server 端更应该掌握</li>
<li>攻击方式：在页面展示内容中参杂 js 代码，以获取网页信息</li>
<li>预防措施： 转换生成 js 的特殊符号</li>
</ul>
<p>转换特殊符号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&amp; &#x3D;&gt; &amp;</span><br><span class="line">&lt; &#x3D;&gt; &lt;</span><br><span class="line">&gt; &#x3D;&gt; &gt;</span><br><span class="line">&quot; &#x3D;&gt; &quot;</span><br><span class="line">&#39; &#x3D;&gt; &amp;#x27;</span><br><span class="line">&#x2F; &#x3D;&gt; &#x2F;</span><br></pre></td></tr></table></figure>

<p><code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code></p>
<p><code>npm install xss --save</code></p>
<h3 id="8-3-密码加密和总结"><a href="#8-3-密码加密和总结" class="headerlink" title="8-3 密码加密和总结"></a>8-3 密码加密和总结</h3><ul>
<li>用户名和密码是最不应该泄漏的用户信息</li>
<li>危害：获取用户名和密码，再去尝试登录其他系统</li>
<li>预防措施，将密码加密</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">const crypto &#x3D; require(&#39;crypto&#39;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 密钥</span><br><span class="line">const SECRET_KEY &#x3D; &#39;WJiol_8776#&#39;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; md5 加密</span><br><span class="line">function md5(content) &#123;</span><br><span class="line">  let md5 &#x3D; crypto.createHash(&#39;md5&#39;)</span><br><span class="line">  return md5.update(content).digest(&#39;hex&#39;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 加密函数</span><br><span class="line">function genPassword(password) &#123;</span><br><span class="line">  const str &#x3D; &#96;password&#x3D;$&#123;password&#125;&amp;key&#x3D;$&#123;SECRET_KEY&#125;&#96;</span><br><span class="line">  return md5(str)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  genPassword</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第-9-章-不使用框架开发-server-统一总结"><a href="#第-9-章-不使用框架开发-server-统一总结" class="headerlink" title="第 9 章 不使用框架开发 server 统一总结"></a>第 9 章 不使用框架开发 server 统一总结</h2><h3 id="开发了那些模块，完整的流程"><a href="#开发了那些模块，完整的流程" class="headerlink" title="开发了那些模块，完整的流程"></a>开发了那些模块，完整的流程</h3><ul>
<li>处理 http 接口（路由、method、path、query、req.body）</li>
<li>连接数据库</li>
<li>实现登录</li>
<li>安全（mysql 注入、xss、密码加密）</li>
<li>日志</li>
<li>上线</li>
</ul>
<p>![image-20190616125743411](/Users/lvjiawen/Library/Application Support/typora-user-images/image-20190616125743411.png)</p>
<h3 id="用到了哪些核心的知识点"><a href="#用到了哪些核心的知识点" class="headerlink" title="用到了哪些核心的知识点"></a>用到了哪些核心的知识点</h3><ul>
<li>http、Node.js 处理http、处理路由、MySQL</li>
<li>cookie、session、redis、nginx 反向代理</li>
<li>SQL 注入、XSS 攻击、加密</li>
<li>日志、stream、contrab、readline</li>
<li>线上环境的知识点</li>
</ul>
<h3 id="回顾-server-和前端的区别"><a href="#回顾-server-和前端的区别" class="headerlink" title="回顾 server 和前端的区别"></a>回顾 server 和前端的区别</h3><ul>
<li>服务稳定性</li>
<li>内存 CPU性能永远不够（优化、拓展）</li>
<li>日志记录</li>
<li>安全（包括登录验证）</li>
<li>集群和服务拆分（设计已支持）</li>
</ul>
<h3 id="下一步"><a href="#下一步" class="headerlink" title="下一步"></a>下一步</h3><ul>
<li><p>不实用框架开发，从 0 开始，关注底层 API</p>
</li>
<li><p>很琐碎、很复杂，没有标准可依，很容易将代码写乱</p>
</li>
<li><p>适合学习，但是不适合应用，接下来开始 express 和 koa2</p>
</li>
</ul>
<h2 id="第-10-章-使用-express-重构博客项目"><a href="#第-10-章-使用-express-重构博客项目" class="headerlink" title="第 10 章 使用 express 重构博客项目"></a>第 10 章 使用 express 重构博客项目</h2><h3 id="express-介绍"><a href="#express-介绍" class="headerlink" title="express 介绍"></a>express 介绍</h3><p>express 是 Node.js 最常用的 web server 框架</p>
<h4 id="什么框架"><a href="#什么框架" class="headerlink" title="什么框架"></a>什么框架</h4><ul>
<li>封装基本的 API 和工具，让开发者去关心业务</li>
<li>框架有一定的流程和标准，能形成解决方案</li>
</ul>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p><code>npm install express-generator -g</code></p>
<h4 id="express-总结"><a href="#express-总结" class="headerlink" title="express 总结"></a>express 总结</h4><ul>
<li><p>初始化代码中，各个插件的作用</p>
</li>
<li><p>思考各个插件的实现原理</p>
</li>
<li><p>处理 get 和 post 请求</p>
</li>
<li><p>express 如何处理路由</p>
</li>
<li><p>app.use 到底是怎么回事？</p>
</li>
<li><p>中间件使用过程中，代码中 next 参数是什么？</p>
</li>
</ul>
<h3 id="10-8-express-处理-session"><a href="#10-8-express-处理-session" class="headerlink" title="10-8 express 处理 session"></a>10-8 express 处理 session</h3><ul>
<li>使用 express-session 和 connect-redis</li>
<li>req.sexsion 保存登录信息，登录校验做成 express 中间件</li>
</ul>
<h3 id="10-12-介绍-morgan"><a href="#10-12-介绍-morgan" class="headerlink" title="10-12 介绍 morgan"></a>10-12 介绍 morgan</h3><ul>
<li>access log 记录，直接使用脚手架推荐的 morgan</li>
<li>自定义日志使用 console.log 和 console.error 即可</li>
<li>日志文件拆分、日志内容分析</li>
</ul>
<h3 id="10-14-express-中间件原理"><a href="#10-14-express-中间件原理" class="headerlink" title="10-14 express 中间件原理"></a>10-14 express 中间件原理</h3><ul>
<li>app.use 用来注册中间件，先收集起来</li>
<li>遇到 http 请求，根据 path 和 method 判断触发那些</li>
<li>实现 next 机制，即上一个通过 next 触发下一个</li>
</ul>
<h3 id="10-15-中间件代码实现"><a href="#10-15-中间件代码实现" class="headerlink" title="10-15 中间件代码实现"></a>10-15 中间件代码实现</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> slice = <span class="built_in">Array</span>.prototype.slice</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LikeExpress</span> </span>&#123;</span><br><span class="line">	<span class="keyword">constructor</span>() &#123;</span><br><span class="line">		<span class="comment">// 存放中间件的列表</span></span><br><span class="line">		<span class="keyword">this</span>.routes = &#123;</span><br><span class="line">			all: [], <span class="comment">// app.use(...)</span></span><br><span class="line">			<span class="keyword">get</span>: [], // app.<span class="keyword">get</span>(...)</span><br><span class="line">			post: [] // app.post(...)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">  register(path) &#123;</span><br><span class="line">    <span class="keyword">const</span> info = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> path === <span class="string">'string'</span>) &#123;</span><br><span class="line">      info.path = path</span><br><span class="line">      <span class="comment">// 从第二个参数开始，转换为数组，存入 stack</span></span><br><span class="line">      info.stack = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      info.path = <span class="string">'/'</span></span><br><span class="line">      <span class="comment">// 从第二个参数开始，转换为数组，存入 stack</span></span><br><span class="line">      info.stack = slice.call(<span class="built_in">arguments</span>, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> info</span><br><span class="line">  &#125;</span><br><span class="line">	</span><br><span class="line">	use() &#123;</span><br><span class="line">    <span class="comment">// TODO 为什么不能直接写</span></span><br><span class="line">		<span class="keyword">const</span> info = <span class="keyword">this</span>.register.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">    <span class="keyword">this</span>.routes.all.push(info)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">get</span>() &#123;</span><br><span class="line">		<span class="comment">// TODO 为什么不能直接写</span></span><br><span class="line">		<span class="keyword">const</span> info = <span class="keyword">this</span>.register.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">    <span class="keyword">this</span>.routes.get.push(info)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	post() &#123;</span><br><span class="line">		<span class="comment">// TODO 为什么不能直接写</span></span><br><span class="line">		<span class="keyword">const</span> info = <span class="keyword">this</span>.register.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">    <span class="keyword">this</span>.routes.post.push(info)</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">  match(method, url) &#123;</span><br><span class="line">    <span class="keyword">let</span> stack = []</span><br><span class="line">    <span class="keyword">if</span> (url == <span class="string">'/favicon.icon'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> stack</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取 routes</span></span><br><span class="line">    <span class="keyword">let</span> currentRoutes = []</span><br><span class="line">    currentRoutes = currentRoutes.concat(<span class="keyword">this</span>.routes.all)</span><br><span class="line">    currentRoutes = currentRoutes.concat(<span class="keyword">this</span>.routes[method])</span><br><span class="line">    currentsRoutes.forEach(<span class="function"><span class="params">routeInfo</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (url.indexOf(routeInfo.path) === <span class="number">0</span>) &#123;</span><br><span class="line">        stack = stack.concat(routeInfo.stack)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> stack</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 核心的 next 机制</span></span><br><span class="line">  handle(req, res, stack) &#123;</span><br><span class="line">    <span class="keyword">const</span> next = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 拿到第一个匹配的中间件</span></span><br><span class="line">      <span class="keyword">const</span> middleware = stack.shift()</span><br><span class="line">      <span class="keyword">if</span> (middleware) &#123;</span><br><span class="line">      	<span class="comment">// 执行中间件函数  </span></span><br><span class="line">        middleware(req, res, next)</span><br><span class="line">      &#125;</span><br><span class="line">		&#125;</span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  callback() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">      res.json = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        res.setHeader(<span class="string">'Content-type'</span>, <span class="string">'application/json'</span>)</span><br><span class="line">        res.end(</span><br><span class="line">        	<span class="built_in">JSON</span>.stringify(data)</span><br><span class="line">        )</span><br><span class="line">			&#125;</span><br><span class="line">      <span class="keyword">const</span> url = req.url</span><br><span class="line">      <span class="keyword">const</span> method = req.method.toLowerCase()</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> resultList = <span class="keyword">this</span>.match(method, url)</span><br><span class="line">      <span class="keyword">this</span>.handle(req, res, resultList)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">	</span><br><span class="line">	listen(...args) &#123;</span><br><span class="line">		<span class="keyword">const</span> server = http.createServer(<span class="keyword">this</span>.callback())</span><br><span class="line">    server.listen(...args)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂函数</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> LikeExpress()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第-11-章-使用-Koa2-重构博客项目"><a href="#第-11-章-使用-Koa2-重构博客项目" class="headerlink" title="第 11 章 使用 Koa2 重构博客项目"></a>第 11 章 使用 Koa2 重构博客项目</h2><h3 id="async-await-语法介绍"><a href="#async-await-语法介绍" class="headerlink" title="async / await 语法介绍"></a>async / await 语法介绍</h3> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">const fs &#x3D; require(&#39;fs&#39;)</span><br><span class="line">const path &#x3D; require(&#39;path&#39;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 用 promise 获取文件内容</span><br><span class="line">function getFileContent(fileName) &#123;</span><br><span class="line">  const promise &#x3D; new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">      const fullFileName &#x3D; path.resolve(__dirname, &#39;files&#39;, fileName)</span><br><span class="line">      fs.readFile(fullFileName, (err, data) &#x3D;&gt; &#123;</span><br><span class="line">          if (err) &#123;</span><br><span class="line">              reject(err)</span><br><span class="line">              return</span><br><span class="line">          &#125;</span><br><span class="line">          resolve(</span><br><span class="line">              JSON.parse(data.toString())</span><br><span class="line">          )</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  return promise</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function readFileData() &#123;</span><br><span class="line">  &#x2F;&#x2F; 同步写法</span><br><span class="line">  try &#123;</span><br><span class="line">      const aData &#x3D; await getFileContent(&#39;a.json&#39;)</span><br><span class="line">      console.log(&#39;a data&#39;, aData)</span><br><span class="line">      const bData &#x3D; await getFileContent(aData.next)</span><br><span class="line">      console.log(&#39;b data&#39;, bData)</span><br><span class="line">      const cData &#x3D; await getFileContent(bData.next)</span><br><span class="line">      console.log(&#39;c data&#39;, cData)</span><br><span class="line">  &#125; catch (err) &#123;</span><br><span class="line">      console.error(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">readFileData()</span><br></pre></td></tr></table></figure>



<ul>
<li><p>await 后面可以追加 promise 对象，获取 resolve 的值</p>
</li>
<li><p>await 必须包裹在 async 函数里面</p>
</li>
<li><p>async 函数执行返回的也是一个 promise 对象</p>
</li>
<li><p>try-catch 截获 promise 中 reject 的值</p>
</li>
</ul>
<h3 id="Koa-2-简介"><a href="#Koa-2-简介" class="headerlink" title="Koa 2 简介"></a>Koa 2 简介</h3><ul>
<li>express 中间件是异步回调， Koa2 原生支持 async / await</li>
<li>新开发框架和系统，都开始觊觎 koa2，例如 egg.js</li>
<li>express 虽然未过时，但是 koa2 肯定是未来的趋势</li>
</ul>
<h4 id="Koa-2-安装"><a href="#Koa-2-安装" class="headerlink" title="Koa 2 安装"></a>Koa 2 安装</h4><p><code>npm install koa-generator -g</code></p>
<h4 id="Koa-2-路由介绍"><a href="#Koa-2-路由介绍" class="headerlink" title="Koa 2 路由介绍"></a>Koa 2 路由介绍</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">router.prefix(&#39;&#x2F;users&#39;)</span><br><span class="line"></span><br><span class="line">router.get(&#39;&#x2F;&#39;, async (ctx, next) &#x3D;&gt; &#123;</span><br><span class="line">  await ctx.render(&#39;index&#39;, &#123;</span><br><span class="line">    title: &#39;Hello Koa 2!&#39;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(&#39;&#x2F;string&#39;, async (ctx, next) &#x3D;&gt; &#123;</span><br><span class="line">  ctx.body &#x3D; &#39;koa2 string&#39;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(&#39;&#x2F;json&#39;, async (ctx, next) &#x3D;&gt; &#123;</span><br><span class="line">  ctx.body &#x3D; &#123;</span><br><span class="line">    title: &#39;koa2 json&#39;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h4 id="中间件机制"><a href="#中间件机制" class="headerlink" title="中间件机制"></a>中间件机制</h4><p>切入点：</p>
<ul>
<li>app.use 是什么</li>
<li>next 是什么</li>
</ul>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><ul>
<li>app.use 用来注册中间件，先收集起来</li>
<li>实现 next 机制，即上一个通过 next 出发下一个</li>
<li>（不涉及 method 和 path 的判断）</li>
</ul>
<h3 id="Koa-2-中间件原理"><a href="#Koa-2-中间件原理" class="headerlink" title="Koa 2 中间件原理"></a>Koa 2 中间件原理</h3><p>洋葱圈模型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">const http &#x3D; require(&#39;http&#39;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 组合中间件</span><br><span class="line">function compose(middlewareList) &#123;</span><br><span class="line">  return function (ctx) &#123;</span><br><span class="line">    &#x2F;&#x2F; 关于各种中间件调用的逻辑</span><br><span class="line">    function dispatch(i) &#123;</span><br><span class="line">      const fn &#x3D; middlewareList[i]</span><br><span class="line">      try &#123;</span><br><span class="line">        return Promise.resolve( &#x2F;&#x2F; 防止传入的不是 Promise 函数</span><br><span class="line">          fn(ctx, dispatch.bind(null, i+1)) &#x2F;&#x2F; 本身就是 Promise 函数</span><br><span class="line">        )</span><br><span class="line">      &#125; catch(err) &#123;</span><br><span class="line">        return Promise.reject(err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return dispatch(0)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class LikeKoa2 &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    this.middlewareList &#x3D; []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  use(fn) &#123;</span><br><span class="line">    this.middlewareList.push(fn)</span><br><span class="line">    return this</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  createContext(req, res) &#123;</span><br><span class="line">    const ctx &#x3D; &#123;</span><br><span class="line">      req,</span><br><span class="line">      res</span><br><span class="line">    &#125;</span><br><span class="line">    return ctx</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleRequest(ctx, fn) &#123;</span><br><span class="line">    return fn(ctx)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  callback() &#123;</span><br><span class="line">    const fn &#x3D; compose(this.middlewareList)</span><br><span class="line">    return (req, res) &#x3D;&gt; &#123;</span><br><span class="line">      const ctx &#x3D; this.createContext(req, res)</span><br><span class="line">      return this.handleRequest(ctx, fn)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  listen(...args) &#123;</span><br><span class="line">    const server &#x3D; http.createServer(this.callback())</span><br><span class="line">    server.listen(...args)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; LikeKoa2</span><br></pre></td></tr></table></figure>



<h3 id="koa2-总结"><a href="#koa2-总结" class="headerlink" title="koa2 总结"></a>koa2 总结</h3><ul>
<li>使用 async 和 await 的好处</li>
<li>koa2 的使用，以及如何操作 session redis 日志</li>
<li>koa2 中间件的使用和原理</li>
</ul>
<h3 id="预习"><a href="#预习" class="headerlink" title="预习"></a>预习</h3><ul>
<li>上线</li>
<li>如何实现线上服务稳定性？PM2 是什么</li>
<li>nginx 在线上环境还扮演了什么重要的角色</li>
</ul>
<h2 id="上线与配置"><a href="#上线与配置" class="headerlink" title="上线与配置"></a>上线与配置</h2><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><h3 id="线上环境"><a href="#线上环境" class="headerlink" title="线上环境"></a>线上环境</h3><ul>
<li>服务器稳定性</li>
<li>充分利用服务器硬件资源，以便提高性能</li>
<li>线上日志记录（访问日志，自定义日志，错误日志）</li>
</ul>
<h3 id="PM2"><a href="#PM2" class="headerlink" title="PM2"></a>PM2</h3><ul>
<li>进程守护，系统崩溃自动重启</li>
<li>启动多进程，充分利用 CPU 和内存</li>
<li>自带日志记录功能</li>
</ul>
<h4 id="PM2-介绍"><a href="#PM2-介绍" class="headerlink" title="PM2 介绍"></a>PM2 介绍</h4><h5 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h5><p><code>npm install pm2 -g</code></p>
<p><code>pm2 --version</code></p>
<h5 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h5><p>启动 <code>cross-env NODE_ENV=production pm2 start app.js</code></p>
<p>查看 <code>pm2 list</code></p>
<h5 id="核心价值"><a href="#核心价值" class="headerlink" title="核心价值"></a>核心价值</h5><ul>
<li>进程守护</li>
<li>多进程启动</li>
<li>线上日志记录</li>
</ul>
<h5 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h5><p><code>pm2 start …</code> 可以跟配置文件作为参数</p>
<p><code>pm2 list</code> 程序列表</p>
<p><code>pm2 restart ${appName|/${id}</code>  重启进程</p>
<p><code>pm2 stop ${appName|/${id}</code>停止</p>
<p><code>pm2 delete ${appName|/${id}</code> 删除</p>
<p><code>pm2 info ${appName|/${id}</code> 信息</p>
<p><code>pm2 log ${appName|/${id}</code> 日志</p>
<p><code>pm2 monit ${appName|/${id}</code> 监控</p>
<h3 id="PM2-进程守护"><a href="#PM2-进程守护" class="headerlink" title="PM2 进程守护"></a>PM2 进程守护</h3><p>pm2 遇到进程崩溃，会自动重启</p>
<h3 id="PM2-配置和日志记录"><a href="#PM2-配置和日志记录" class="headerlink" title="PM2 配置和日志记录"></a>PM2 配置和日志记录</h3><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><ul>
<li>新建 PM2 配置文件（包括进程数量，日志文件目录等）</li>
</ul>
<p>pm2.config.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;pm2-test-server&quot;,</span><br><span class="line">  &quot;script&quot;: &quot;app.js&quot;,</span><br><span class="line">  &quot;watch&quot;: true, &#x2F;&#x2F; 是否监听文件变化</span><br><span class="line">  &quot;ignore_watch&quot;: [</span><br><span class="line">    &quot;node_modules&quot;,</span><br><span class="line">    &quot;logs&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;error_file&quot;: &quot;logs&#x2F;err.log&quot;,</span><br><span class="line">  &quot;out_file&quot;: &quot;logs&#x2F;out.log&quot;,</span><br><span class="line">  &quot;log_date_format&quot;: &quot;YYYY-MM-DD HH:mm:ss&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>修改 PM2 启动命令，重启</li>
<li>访问 server，检查日志文件的内容（日志记录是否生效）</li>
</ul>
<h3 id="PM2-多进程"><a href="#PM2-多进程" class="headerlink" title="PM2 多进程"></a>PM2 多进程</h3><h4 id="为何使用多进程"><a href="#为何使用多进程" class="headerlink" title="为何使用多进程"></a>为何使用多进程</h4><p>![image-20190628101837144](/Users/lvjiawen/Library/Application Support/typora-user-images/image-20190628101837144.png)</p>
<ul>
<li>单个进程的内存是受到限制的</li>
<li>一个进程无法利用机器的全部内存</li>
<li>多进程能够充分利用 CPU 多核的优势</li>
</ul>
<h4 id="多进程和-redis"><a href="#多进程和-redis" class="headerlink" title="多进程和 redis"></a>多进程和 redis</h4><p>多个进程的 session 无法共享</p>
<p>![image-20190628102048890](/Users/lvjiawen/Library/Application Support/typora-user-images/image-20190628102048890.png)</p>
<p>使用redis 解决</p>
<p>![image-20190628102123289](/Users/lvjiawen/Library/Application Support/typora-user-images/image-20190628102123289.png)</p>
<p>pm2 会自动在寻找空闲进程进行负载均衡</p>
<h2 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h2><p>![image-20190628103112542](/Users/lvjiawen/Library/Application Support/typora-user-images/image-20190628103112542.png)</p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 daughlas@gmail.com </span>
    </div>
</article>



<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>慕课网 Node.js 从零开发 web server博客项笔记</p>
    
    <p><span class="copy-title">本文作者:</span><a  title="吕嘉文">吕嘉文</a></p>
    <p><span class="copy-title">发布时间:</span>2020-06-01, 17:55:35</p>
    <p><span class="copy-title">最后更新:</span>2020-06-01, 17:56:00</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/2020/06/01/temp/%E6%85%95%E8%AF%BE%E7%BD%91%20Node.js%20%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%8F%91%20web%20server%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%AC%94%E8%AE%B0/" title="慕课网 Node.js 从零开发 web server博客项笔记">http://yoursite.com/2020/06/01/temp/%E6%85%95%E8%AF%BE%E7%BD%91%20Node.js%20%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%8F%91%20web%20server%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%AC%94%E8%AE%B0/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>





    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2016-2020 daughlas</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" ></a>

    </div>
</div>
<div class="acParent"></div>

</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#javascript','#临时','#vue','#vue-router','#vue-cli','#angular','#Node.js',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().split('\n').length - 1, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: #fafafa;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
